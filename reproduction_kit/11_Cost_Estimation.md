# 11. コスト見積もりと最適化

このシステムを運用する際のコストと、コストを抑えるための方法について説明します。

## 1. API利用コストの見積もり

### 1.1 動画1本あたりのコスト（5分動画の場合）

#### パターンA: Gemini中心（推奨・最安）

| サービス | 用途 | 料金 |
|---------|------|------|
| Google Gemini | テーマ選定・台本生成・タイトル生成 | **無料〜$0.10** |
| Google Gemini | 画像生成（背景10枚） | **無料〜$0.20** |
| AIVIS Speech | 音声合成（ローカルサーバー） | **無料** |
| **合計** | | **無料〜約¥30** |

#### パターンB: OpenAI中心（高品質・高コスト）

| サービス | 用途 | 料金 |
|---------|------|------|
| OpenAI GPT-4 | テーマ選定・台本生成・タイトル生成 | **$0.50〜2.00** |
| DALL-E 3 | 画像生成（背景10枚） | **$0.40** |
| AIVIS Speech | 音声合成（ローカルサーバー） | **無料** |
| **合計** | | **約¥140〜350** |

### 1.2 月間コスト見積もり

**動画30本/月の場合**:
- **パターンA (Gemini)**: 無料〜約¥900/月
- **パターンB (OpenAI)**: 約¥4,200〜10,500/月

**動画100本/月の場合**:
- **パターンA (Gemini)**: 無料〜約¥3,000/月
- **パターンB (OpenAI)**: 約¥14,000〜35,000/月

---

## 2. コスト最適化の方法

### 2.1 開発段階でのコスト削減

#### 開発モードの活用
```bash
pnpm dev
```

開発モードでは以下の制限が適用されます：
- 画像生成枚数の制限（1日20枚まで）
- キャッシュ機能の有効化（同じ入力は再利用）
- デバッグ用のモックAPIの使用

#### 設定ファイルでの制限
`config/development_config.yaml`:
```yaml
development:
  max_api_calls_per_day: 100
  enable_cache: true
  cache_expiry_hours: 24
```

### 2.2 本番運用でのコスト削減

#### 1. Gemini APIを優先的に使用
- OpenAIよりも大幅に安価
- 無料枠が充実している
- 品質も十分高い

設定例 (`config/llm_config.yaml`):
```yaml
primary_provider: "google"
fallback_provider: "openai"  # Geminiが使えない場合のみ
```

#### 2. 画像生成の最適化
- 背景画像の枚数を減らす（10枚 → 5枚）
- 解像度を下げる（1920x1080 → 1280x720）
- 既存の画像を再利用する

#### 3. キャッシュ機能の活用
同じテーマや類似した台本の場合、過去の結果を再利用します。

#### 4. バッチ処理
複数の動画を一度に生成することで、API呼び出しを効率化します。

---

## 3. 無料枠の活用

### 3.1 Google Gemini API
- **無料枠**: 月間一定量まで無料（詳細は公式サイト参照）
- **推奨**: 開発段階では無料枠内で十分

### 3.2 YouTube Data API
- **無料枠**: 1日10,000リクエストまで無料
- 動画アップロードは1リクエスト約1,600ユニット
- 1日6本程度まで無料で投稿可能

---

## 4. コスト監視の設定

### 4.1 使用量の記録
システムは自動的にAPI使用量をデータベースに記録します。

```bash
# 使用量レポートの確認（実装予定）
pnpm cli cost:report --month 2025-01
```

### 4.2 アラート設定
`.env` ファイルで1日の上限を設定できます：
```ini
DAILY_API_QUOTA_OPENAI=1000
DAILY_API_QUOTA_IMAGE_GEN=100
```

上限に達すると処理が停止し、警告が表示されます。

---

## 5. 実際の運用例

### 例1: 個人の趣味チャンネル（月10本）
- **使用API**: Gemini（LLM + 画像）、AIVIS Speech（ローカル）
- **月間コスト**: **無料〜約¥100**
- **戦略**: 無料枠を最大限活用、キャッシュ機能ON

### 例2: 小規模ビジネス（月30本）
- **使用API**: Gemini（LLM + 画像）、AIVIS Speech（ローカル）
- **月間コスト**: **無料〜約¥900**
- **戦略**: 開発モードでテスト、本番は効率的に

### 例3: 本格運用（月100本）
- **使用API**: Gemini + OpenAI（品質重視の場合のみ）、AIVIS Speech（ローカル）
- **月間コスト**: **無料〜約¥3,000** (Geminiのみ) / **約¥14,000〜35,000** (OpenAI併用)
- **戦略**: バッチ処理、画像再利用、品質とコストのバランス

---

## 6. コスト削減チェックリスト

- [ ] 開発時は必ず `--dev-mode` を使用
- [ ] Gemini APIを優先的に使用
- [ ] 画像生成枚数を必要最小限に
- [ ] キャッシュ機能を有効化
- [ ] API使用量を定期的に確認
- [ ] 不要なステップはスキップ
- [ ] テスト時はモックAPIを使用

---

## まとめ

適切な設定とAPI選択により、**完全無料〜動画1本あたり約¥30**という低コストでの運用が可能です。
AIVIS Speechをローカルサーバーとして使用し、Geminiの無料枠を活用することで、完全無料での運用も可能です。
