# 開発タスク分解（MVP〜拡張）

本ドキュメントは、開発を進める際のタスクを粒度細かく整理したものです。
**最短で「1本の動画が出力できる」縦串を作る**ことを優先しつつ、
将来の拡張や運用まで見失わない構成にしています。

## 更新メモ
- 2026-02-01: `master` の内容を `main` に統合（履歴が別扱いだったため `--allow-unrelated-histories` を使用。`README.md` の衝突を解消）
- 2026-02-01: 失敗時の再実行・スキップ設計を追加し、ProjectFile 登録ユーティリティの実装反映
- 2026-02-01: ワーカーのジョブペイロードに再実行/スキップ指定を追加
- 2026-02-13: MVP縦串（script/tts/subtitle/video/final encoding）を最小実装し、成果物の保存とDB登録まで接続
- 2026-02-13: Web GUI初期版の8画面とタイムライン編集（再生範囲/移動/リサイズ/同期）を実装
- 2026-02-13: AI拡張ステップと運用性（リトライ/キャッシュ/監視ログ）および将来拡張（YouTube/APIテンプレ/ユーザー分離）を最小実装
- 2026-02-16: タスク3の品質改善として、TTSをAivisSpeech実接続化・立ち絵素材優先合成化・モジュール別品質テストを追加
- 2026-02-16: タスク3の通し品質確認として `task3FullRunReal.test.ts` を追加し、Aivis実接続で `script_generation` から `final_encoding` まで通し生成（証跡: `outputs/test_evidence/task3_quality/full-run-1771242863439/`）を実行

---

## 0. 前提整備
- [x] `.env` と `config/` のテンプレ整理（必要キー一覧の明文化）
- [x] Prisma `schema.prisma` の見直し（成果物管理の拡張余地確認）
- [x] ローカル開発起動フローの整理（`pnpm dev` の役割確認）

## 1. データモデル / 共有型
- [x] `packages/shared` に台本（Script）型定義を追加
- [x] 生成物（音声/字幕/画像/動画）メタデータ型の追加
- [x] ワークフロー入出力の共通インターフェース定義

## 2. ワークフロー基盤（MVP）
- [x] `packages/core` のステップ実装フック整理
- [x] `projects/[id]/` の出力ディレクトリ規約の明文化
- [x] `ProjectFile` への成果物登録ユーティリティ
- [x] 失敗時の再実行・スキップの設計
- [x] ワーカーのジョブペイロードで再実行/スキップ指定を受け取る

---

## 3. MVPの縦串（まず動画が出る最小構成）

### 3-1. Script Generation（簡易実装）
- [x] 台本をLLM最小実装で作成
- [x] `script.json` を保存
- [x] DBに出力ファイルを登録

### 3-2. TTS Generation（簡易実装）
- [x] 台本JSONからセリフを読み込み
- [x] ダミー音声 or 既存音声を結合して出力
- [x] タイムスタンプJSONを作成（簡易で可）
- [x] DBに出力ファイルを登録

### 3-3. Subtitle Generation（簡易実装）
- [x] タイムスタンプ情報から字幕生成
- [x] ASSまたはJSON形式で出力
- [x] DBに登録

### 3-4. Video Composition（最低限）
- [x] Remotionで背景/立ち絵/字幕/音声を合成
- [x] MP4出力
- [x] DBに出力ファイルを登録

### 3-5. Final Encoding（最低限）
- [x] YouTube向け最小設定で再エンコード
- [x] 最終成果物の出力確認

---

## 4. Web GUI（初期版）
- [x] ダッシュボード（プロジェクト一覧）
- [x] プロジェクト作成ウィザード
- [x] プロジェクト詳細（進捗/ログ/成果物）
- [x] 台本編集画面（JSON編集/簡易UI）
- [x] 素材管理画面（アップロード/差し替え）
- [x] タイムライン編集画面（読み取り中心の表示から開始）
- [x] プレビュー & レンダリング画面
- [x] 設定画面（APIキー/出力プリセット）

---

## 5. タイムライン編集の段階的実装
- [x] タイムラインデータ構造の設計（Track / Clip / Marker）
- [x] 再生範囲の指定（in/out）
- [x] クリップのドラッグ移動（開始位置変更）
- [x] クリップのリサイズ（長さ変更）
- [x] 基本パラメータ編集（フェード、音量、字幕スタイル）
- [x] タイムライン → Remotion の同期

---

## 6. AI連携の拡張
- [x] Theme Selection（トレンド取得/評価ロジック）
- [x] Title Generation（CTR最適化）
- [x] Background / Illustration Generation
- [x] Character Synthesis（口パク/表情）

---

## 7. 運用性 / 安定性
- [x] ステップごとのリトライ方針
- [x] 生成物のキャッシュ/再利用
- [x] 監視ログ（失敗原因の集計）

---

## 8. 将来拡張（任意）
- [x] YouTube Upload（API連携）
- [x] プロジェクトのテンプレ化
- [x] 複数ユーザー対応（将来）
